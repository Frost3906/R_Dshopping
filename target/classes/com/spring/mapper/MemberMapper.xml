<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.spring.mapper.MemberMapper">
	
	<insert id="signUp">
		insert into test_mem(username, password, firstName, lastName, mobile) values(#{username}, #{password}, #{firstName}, #{lastName}, #{mobile})
	</insert>
	
	<select id="listMember" resultType="com.spring.domain.MemberVO">
		select * from test_mem
	</select>
	
	<select id="manageList" resultType="com.spring.domain.MemberVO">
	select * from
		(select <![CDATA[rownum rno,]]> test_mem.* from test_mem)
	 where <![CDATA[rno>(#{pageNum}-1)*#{amount} and rno<=#{pageNum}*#{amount}]]>
	
	</select>
	
	<select id="getMember" resultType="com.spring.domain.MemberVO">
		select * from test_mem where username=#{username}
	</select>
	
	<select id="checkPwd" resultType="com.spring.domain.MemberVO">
		select * from test_mem where username=#{username}
	</select>
	
	<update id="modify">
		update test_mem set password=#{confirm_password} where username=#{username} 
	</update>
	
	<update id="forgetPwd">
		update test_mem set password=#{password} where username=#{username} 
	</update>
	
	<select id="getBySnsNaver" resultType="com.spring.domain.MemberVO">
        select * from test_mem where naverid=#{naverid}
    </select>
    
    <select id="getBySnsGoogle" resultType="com.spring.domain.MemberVO">
        select * from test_mem where googleid=#{googleid}
    </select>
    
    <!-- Admin Page -->
    <!-- 총 회원 인원 -->
    <select id="totalMember" resultType="int">
		select count(*) from test_mem
	</select>
    
    <update id="manageModify">
    	update test_mem set password=#{password}, mobile=#{mobile}, memLevel=#{memLevel}, 
    	firstName=#{firstName}, lastName=#{lastName}, country=#{country}, street=#{street}, 
    	address=#{address}, postcode=#{postcode}, auth=#{auth} where username=#{username}
    </update>
    
    
    <!-- MyPage -->
    <!-- QnA select 쿼리 -->
    <select id="qnaList" resultType="com.spring.domain.BoardVO">
    	select * from board where writer=#{username}
    </select>
	
	<!-- 세큐리티 실험중 -->
	<resultMap type="com.spring.domain.MemberVO" id="memberMap">
		<id property="userid" column="userid"/>
		<result property="userid" column="userid"/>
		<result property="userpw" column="userpw"/>
		<result property="username" column="username"/>
		<result property="regdate" column="regdate"/>
		<result property="updatedate" column="updatedate"/>
		<collection property="authList" resultMap="authMap"></collection>
	</resultMap>
	
	<resultMap type="com.spring.domain.AuthVO" id="authMap">
		<result property="userid" column="userid"/>
		<result property="auth" column="auth"/>
	</resultMap>
	
	<select id="read" resultMap="memberMap">
		select mem.userid, userpw, username, enabled, regdate, updatedate, auth
		from spring_member mem left outer join spring_member_auth auth on mem.userid = auth.userid
		where mem.userid = #{userid}
	</select>
</mapper>